<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
	<title>Mac & Location</title>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=fOATGSYuFGYgzyriZhd2ccqK63ngqE98"></script>
	<style>
		html{height:100%}  
		body{height:100%;margin:0px;padding:0px}  
		#container{height:100%}  
	</style>
</head>
<body>
	<div id="container"></div>
	<script>
		function startRequest(url, callback) {
			var xhr = new XMLHttpRequest();
			xhr.onreadystatechange = function() {
				if (xhr.readyState === 4) {
					if ((xhr.status >= 200 && xhr.status < 300) || xhr.status === 304) {
						callback(JSON.parse(xhr.responseText));
					} else {
						alert('Request error: ' + xhr.status);
						console.log(xhr);
					}
				}
			}
			xhr.open('get', url, true);
			xhr.send();
		}

		function drawPoints(data) {
			//坐标转换完之后的回调函数
		    translateCallback = function(data) {
		    	var i, len, points = data.points, polyline;
		        if(data.status === 0) {
			      	for (i = 0, len = points.length; i < len; ++i) {
			      		var marker = new BMap.Marker(points[i]);
				        bm.addOverlay(marker);
				        var label = new BMap.Label(times[i]);
				        marker.setLabel(label); //添加百度label
			      	}
				    bm.centerAndZoom(points[0], 15);
			        polyline = new BMap.Polyline(points);
			        bm.addOverlay(polyline);
		        }
		    }
			var arr = data.response.docs,
				points = [],
				times = [],
				convertor = new BMap.Convertor(),
				i, len;
			for (i = 0, len = arr.length; i < len; ++i) {
				if (arr[i].longitude && arr[i].latitude) {
					points.push(new BMap.Point(arr[i].longitude, arr[i].latitude));
					times.push(arr[i].cap_time);
				}
			}
		    convertor.translate(points, 1, 5, translateCallback);
		}
		// startRequest('http://localhost:8983/solr/terminal_feature_db/select?facet.field=mac&facet=on&q=*:*&rows=0&sort=mac%20asc&facet.limit=1000');
		
		var macLocationUrl = 'http://localhost:8983/solr/terminal_feature_db/select?fl=latitude,longitude,mac_type,cap_time&q=mac:${MAC}&rows=10&sort=cap_time%20desc',
			bm = new BMap.Map("container");

	    bm.addControl(new BMap.NavigationControl());
	    bm.enableScrollWheelZoom(true); 

		startRequest(macLocationUrl.replace('${MAC}', '7C-C7-09-98-30-2D'), drawPoints);
	    
	</script>
</body>
</html>
